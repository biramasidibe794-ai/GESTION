{% extends "base.html" %}
{% block title %}Accueil{% endblock %}

{% block content %}
<div class="row g-3">

  {# --------- INVIT√â --------- #}
  {% if role == "guest" %}
    <div class="col-12 col-lg-8">
      <div class="card shadow-soft">
        <div class="card-body">
          <h3 class="mb-2">Bienvenue üëã</h3>
          <p class="text-muted">Connectez-vous pour acc√©der √† vos fonctionnalit√©s.</p>
          <div class="d-flex gap-2">
            <a class="btn btn-primary" href="{% url 'login' %}">Connexion</a>
            <a class="btn btn-outline-primary" href="{% url 'signup' %}">Inscription</a>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {# --------- ENSEIGNANT --------- #}
  {% if role == "enseignant" %}
    <div class="col-12">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <h3 class="m-0">Espace enseignant</h3>
        <div class="d-flex gap-2">
          <a href="{% url 'liste_cours' %}" class="btn btn-outline-primary btn-sm">Mes cours</a>
          <a href="{% url 'liste_seances' %}" class="btn btn-primary btn-sm">Mes s√©ances</a>
        </div>
      </div>
    </div>

    <div class="col-6 col-lg-3">
      <div class="card shadow-soft text-center">
        <div class="card-body">
          <div class="text-muted">Cours</div>
          <div class="display-6 fw-bold">{{ kpi.total_cours|default:"0" }}</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card shadow-soft text-center">
        <div class="card-body">
          <div class="text-muted">S√©ances aujourd'hui</div>
          <div class="display-6 fw-bold">{{ kpi.seances_aujourdhui|default:"0" }}</div>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-soft">
        <div class="card-body">
          <h5 class="mb-3">Prochaines s√©ances</h5>
          {% if prochaines_seances %}
            <div class="table-responsive">
              <table class="table align-middle">
                <thead>
                  <tr>
                    <th>D√©but</th>
                    <th>Fin</th>
                    <th>Classe</th>
                    <th>Cours</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                {% for s in prochaines_seances %}
                  <tr>
                    <td>{{ s.debut }}</td>
                    <td>{{ s.fin }}</td>
                    <td>{{ s.classe.nom }}</td>
                    <td>{{ s.cours.titre }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{% url 'seance_detail' s.id %}">
                        Projecteur QR
                      </a>
                    </td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-muted">Aucune s√©ance √† venir.</div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  {# --------- ETUDIANT --------- #}
  {% if role == "etudiant" %}
    <div class="col-12">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <h3 class="m-0">Espace √©tudiant</h3>
        <div class="d-flex gap-2">
          <a href="{% url 'liste_seances' %}" class="btn btn-primary btn-sm">Mes s√©ances</a>
          <a href="{% url 'liste_presences' %}" class="btn btn-outline-primary btn-sm">Mes pr√©sences</a>
        </div>
      </div>
    </div>

    <div class="col-6 col-lg-3">
      <div class="card shadow-soft text-center">
        <div class="card-body">
          <div class="text-muted">S√©ances pass√©es</div>
          <div class="display-6 fw-bold">{{ kpi.total_seances|default:"0" }}</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card shadow-soft text-center">
        <div class="card-body">
          <div class="text-muted">Pr√©sences</div>
          <div class="display-6 fw-bold">{{ kpi.total_presences|default:"0" }}</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card shadow-soft text-center">
        <div class="card-body">
          <div class="text-muted">Taux</div>
          <div class="display-6 fw-bold">{{ kpi.taux_presence|default:"0" }}%</div>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-soft">
        <div class="card-body">
          <h5 class="mb-3">Prochaines s√©ances</h5>
          {% if prochaines_seances %}
            <div class="table-responsive">
              <table class="table align-middle">
                <thead>
                  <tr>
                    <th>D√©but</th>
                    <th>Fin</th>
                    <th>Classe</th>
                    <th>Cours</th>
                    <th>Enseignant</th>
                  </tr>
                </thead>
                <tbody>
                {% for s in prochaines_seances %}
                  <tr>
                    <td>{{ s.debut }}</td>
                    <td>{{ s.fin }}</td>
                    <td>{{ s.classe.nom }}</td>
                    <td>{{ s.cours.titre }}</td>
                    <td>{{ s.enseignant.user.get_full_name|default:s.enseignant.user.username }}</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-muted">Aucune s√©ance √† venir.</div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  {# --------- PARENT --------- #}
  {% if role == "parent" %}
    <div class="col-12">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <h3 class="m-0">Espace parent</h3>
        <div class="text-muted small">Suivi des pr√©sences des enfants</div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-soft">
        <div class="card-body">
          {% if enfants_stats %}
            <div class="table-responsive">
              <table class="table align-middle">
                <thead>
                  <tr>
                    <th>√âl√®ve</th>
                    <th>Pr√©sences</th>
                    <th>Total marquages</th>
                    <th>Taux</th>
                  </tr>
                </thead>
                <tbody>
                {% for item in enfants_stats %}
                  <tr>
                    <td>{{ item.etudiant.user.get_full_name|default:item.etudiant.user.username }}</td>
                    <td>{{ item.presents }}</td>
                    <td>{{ item.total }}</td>
                    <td>{{ item.taux }}%</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-muted">Aucune donn√©e √† afficher pour le moment.</div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  {# --------- AUTHENTIFI√â/INCONNU --------- #}
  {% if role == "user" %}
    <div class="col-12 col-lg-8">
      <div class="card shadow-soft">
        <div class="card-body">
          <h3 class="mb-2">Bienvenue</h3>
          <p class="text-muted">Votre r√¥le n‚Äôest pas reconnu, menu minimal activ√©.</p>
          <a class="btn btn-primary" href="{% url 'liste_seances' %}">Voir les s√©ances</a>
        </div>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
